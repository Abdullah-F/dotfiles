#!/usr/bin/env ruby

def self.relative_dirs(argv, stdin)
  return argv if argv.any?     # if we have args, they are considered relative paths
  return stdin.read.each_line  # otherwise assume we're piping paths through the program
end

# pbcopy is only available on mac AFAIK
def self.copy_to_clipboard(str)
  require 'open3'
  Open3.popen3("pbcopy") { |stdin, stdout, stderr, wait_thr|
    stdin.write str
  }
end

should_copy   = ARGV.delete('-c') || ARGV.delete('--copy')
absolute_dirs = relative_dirs(ARGV, $stdin).map { |path| File.expand_path(path).chomp }
printer       = method(absolute_dirs.one? ? :print : :puts)
absolute_dirs.each &printer
copy_to_clipboard(absolute_dirs.join "\n") if should_copy
